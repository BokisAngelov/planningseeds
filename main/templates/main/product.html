{% extends 'main.html' %}

{% block content %}

<div class="uk-card uk-card-default uk-padding uk-width-2xlarge">
    <div class="uk-grid">
        {% if productObj.image %}
        <div class="uk-width-1-3">
            <img src="{{ productObj.image.url }}" alt="{{ productObj.name }}">
        </div>
        {% endif %}
        <div class="uk-width-2-3">
            {% if request.user.is_authenticated and request.user.userprofile == productObj.producer %}
            <div>
                <a class="uk-link" href="{% url 'update-product' productObj.id %}"><span uk-icon="icon:pencil; ratio:0.8"></span> Edit</a>
                <a class="uk-link" href="{% url 'delete-product' productObj.id %}"><span uk-icon="icon:trash; ratio:0.8"></span> Delete</a>
            </div>
            {% endif %}
            <h3 class="uk-margin-small-top uk-margin-small-bottom">{{productObj.name}}</h3>
            {% if productObj.quantity > 0 %}
            <p class="uk-margin-small-top uk-margin-small-bottom">Available Quantinty: {{productObj.quantity}}</p>
            {% endif %}
            <p class="uk-margin-small-top uk-margin-small-bottom"><a href="{% url 'user-profile' productObj.producer.id %}">{{productObj.producer.first_name}} {% if productObj.producer.last_name %}{{productObj.producer.last_name}} {% endif %}</a></p>

            {% if productObj.producer.country %}
            <p class="uk-margin-small-top uk-margin-small-bottom"> {{ productObj.producer.country.name }}</p>
            {% endif %}
        </div>
    </div>
    <h3 class="uk-margin-top-large uk-margin-small-bottom">Description</h3>
    <p>{{productObj.description}}</p>

    {% if productObj.category %}
        <h3 class="uk-margin-top uk-margin-small-bottom">Details</h3>
        {% for category in productObj.category.all %}
            <span class="category-span">#{{category}}</span><br>
        {% endfor %}
    {% endif %}
</div>




{% if request.user.userprofile.user_type == 'customer' %}
<a class="uk-button uk-button-primary" href="{% url 'request-offer' productObj.id %}">Request an offer</a>
{% endif %}

<!-- For owner -->
{% if request.user.is_authenticated and request.user.userprofile == productObj.producer and requestsTo %}
<h2>Requests</h2>
<table class="uk-table uk-table-striped">
    <thead>
        <tr>
            <th>Date</th>
            <th>Customer</th>
            <th>Quantity</th>
            <th>Status</th>
            
        </tr>
    </thead>
    <tbody>  
    {% for request in requestsTo %}
        <tr>
            <td>{{request.created}}</td>
            <td><a href="{% url 'user-profile' request.user.id %}">{{ request.user }}</a></td>
            <td>{{ request.quantity }}</td>
            <td>{{ request.status }}</td>
            <td></td>
        </tr>
    {% endfor %}
    </tbody>
</table>
{% endif %}

{% if request.user.userprofile == productObj.producer and offers %}
<h2>Offers</h2>
<table class="uk-table uk-table-striped">
    <thead>
        <tr>
            <th>Date</th>
            <th>Customer</th>
            <th>Quantity</th>
            <th>Unit Price</th>
            <th>Total Price</th>
            <th>Status</th>
        </tr>
    </thead>
    <tbody>  
    {% for offer in offers %}
        <tr>
            <td>{{offer.created}}</td>
            <td><a href="{% url 'user-profile' offer.request.user.id %}">{{offer.request.user}}</a></td>
            <td>{{ offer.quantity }}</td>
            <td>{{offer.unit_price}}</td>
            <td>{{ offer.total_price }}</td>
            <td>{{ offer.status }}</td>
        </tr>
    {% endfor %}
    </tbody>
</table>
{% endif %}

<!-- For customer -->
{% if requestsFrom %}
<h2>My Requests</h2>
<table class="uk-table uk-table-striped">
    <thead>
        <tr>
            <th>Date</th>
            <th>Quantity</th>
            <th>Status</th>
            
        </tr>
    </thead>
    <tbody>  
    {% for request in requestsFrom %}
        <tr>
            <td> {{ request.created }}</td>
            <td>{{ request.quantity }}</td>
            <td>{{ request.status }}</td>
            <td></td>
        </tr>
    {% endfor %}
    </tbody>
</table>
{% endif %}

{% endblock %} 